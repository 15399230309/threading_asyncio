# python 并发编程之协程

******************

### 基本概念
1. 阻塞：
> 阻塞状态指程序未得到所需计算资源时被挂起的状态。程序在等待某个操作完成期间，自身无法继续干别的事情，则称该程序在该操作上是阻塞的。
>>常见的阻塞形式有：网络 I/O 阻塞、磁盘 I/O 阻塞、用户输入阻塞等。阻塞是无处不在的，包括 CPU 切换上下文时，所有的进程都无法真正干事情，它们也会被阻塞。如果是多核 CPU 则正在执行上下文切换操作的核不可被利用。

2. 非阻塞
> 程序在等待某操作的过程中，自身不被阻塞，可以继续运行干别的事情，则称该程序在该操作上是非阻塞的。

3. 同步
> 不同程序单元为了完成某个任务，在执行过程中需要某种通信方式以协调一致，称这些程序单元是同步执行的，单线程程序就是同步执行的，
我们平时用到的函数嵌套调用，一般都是同步执行

4. 异步
> 为了完成某项任务，不同程序单元之间过程中无需通信协调，也能完成任务的方式，不想管的程序单元之间可以是异步的。
>> 例如，爬虫下载网页，调度程序调用下载程序后，即可调度其他任务，而无需与该下载任务保持通信以协调行为， 不同网页的下载，保存等操作
都是无关的，无需相互协调，这些异步操作的完成时刻并不确定。


### 协程
#### 协程，英文叫做 Coroutine，又称微线程，纤程，协程是一种用户态的轻量级线程。
> 协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，回复先前保存的寄存器上下文和栈。因此协程能保留
上一次调用时的状态。

>网络模型有很多中，为了实现高并发也有很多方案，多线程，多进程。无论多线程和多进程，IO的调度更多取决于系统，而协程的方式，调度来自用户，用户可以在函数中yield一个状态。使用协程可以实现高效的并发任务。
Python的在3.4中引入了协程的概念，可是这个还是以生成器对象为基础，3.5则确定了协程的语法。下面将简单介绍asyncio的使用。实现协程的不仅仅是asyncio，tornado和gevent都实现了类似的功能



*******
#### 协程一些概念
* event_loop 事件循环：程序开启一个无限的循环，程序员会把一些函数注册到事件循环上。当满足事件发生的时候，调用相应的协程函数。
* coroutine 协程：协程对象，指一个使用async关键字定义的函数，它的调用不会立即执行函数，而是会返回一个协程对象。协程对象需要注册到事件循环，由事件循环调用。
* task 任务：一个协程对象就是一个原生可以挂起的函数，任务则是对协程进一步封装，其中包含任务的各种状态。
* future： 代表将来执行或没有执行的任务的结果。它和task上没有本质的区别
* async/await 关键字：python3.5 用于定义协程的关键字，async定义一个协程，await用于挂起阻塞的异步调用接口。

******
####  生成器 yeild from 语句、函数语句、特点
* 通常一个函数return 的时候，函数作用域即被销毁，但是yeild语句可以在函数执行过程中产出一个值，暂停函数执行，然后交出程序执行权给调用方，保证调用方可以继续执行其他程序，自身处于保留上线文状态。如果需要回复函数体执行，获取下一个值，可以用next、send等语句去驱动生成器。
> 将一个大的可迭代的对象转换成为一个生成器对象，有助于节省内存

#### 基于生成器的协程
* 通过yeild产出值，通过send给yeild表达式赋值

